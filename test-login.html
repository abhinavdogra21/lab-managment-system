<!DOCTYPE html>
<html>
<head>
    <title>Test Login Flow</title>
</head>
<body>
    <h1>Testing Login Flow for labstaff2</h1>
    <button onclick="testLogin()">Test Login</button>
    <div id="output"></div>

    <script>
        async function testLogin() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>Testing login...</p>';
            
            try {
                console.log('Starting login test...');
                
                // Simulate the exact same call the form makes
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: 'labstaff2@lnmiit.ac.in',
                        password: '123',
                        userRole: 'lab-staff'
                    })
                });

                const data = await response.json();
                console.log('API Response:', data);
                
                if (response.ok) {
                    // Store user data in localStorage (same as form)
                    localStorage.setItem('user', JSON.stringify(data.user));
                    console.log('User stored in localStorage:', JSON.stringify(data.user));
                    
                    // Redirect to role-scoped dashboard (same as form)
                    const role = data?.user?.role || '';
                    const target = role ? `/${role}/dashboard` : '/';
                    console.log('Redirecting to:', target);
                    
                    output.innerHTML = `
                        <p>✅ Login successful!</p>
                        <p>Role: ${role}</p>
                        <p>Target URL: ${target}</p>
                        <p>Redirecting in 2 seconds...</p>
                    `;
                    
                    // Redirect after 2 seconds to see the output
                    setTimeout(() => {
                        window.location.href = target;
                    }, 2000);
                    
                } else {
                    output.innerHTML = `<p>❌ Login failed: ${data.error || 'Unknown error'}</p>`;
                    console.error('Login failed:', data);
                }
            } catch (error) {
                output.innerHTML = `<p>❌ Error: ${error.message}</p>`;
                console.error('Login error:', error);
            }
        }
    </script>
</body>
</html>
